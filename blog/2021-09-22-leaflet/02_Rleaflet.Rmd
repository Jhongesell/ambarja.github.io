---
author: Antony Barja
banner: https://user-images.githubusercontent.com/23284899/134397890-d637ce41-5eb8-48de-b03f-31255a218b55.png
categories:
- R
date: "2020-02-16"
tags:
- leaflet
- R 
title: Mapas interactivos en Leaflet desde R 
---

En las 칰ltimas tres d칠cadas el avance tecnol칩gico y la conexi칩n a internet han tenido grandes impactos en el desarrollo de la evoluci칩n de la cartograf칤a web, este crecimiento es reciente y tuvo un punto clave en el a침o 2005,donde el Tsunami en ASI y Hurac치n Katrina, alertaron a la comunidad mundial sobre la importancia de utilizar tecnolog칤a cartogr치fica web para gestionar y responder tales eventos. Otro claro ejemplo de su importancia podemos ver en el trabajo realizado por la universidad de John Hopkins durante la pandemia donde generar칩n mapas inter치ctivos donde se evidenci칩 la evoluci칩n de los casos de coranovirus por pa칤s, finalmente algunos pa칤ses est치n implementado el monitoreo de la cobertura de vacunaci칩n por COVID-19 en plataformas webs donde la el n칰cleo de la visualiaci칩n se enfoca en los mapas interactivos.

Como puedes notar el empleo de los mapas web es muy importante dentro de la toma de decisiones y en este peque침o post vamos a realizar un demo utilizando la librer칤a leaflet, una librer칤a de JavaScript especializada en el desarrollo de mapas webs, pero dentro de R con el paquete leaflet y derivados.

## Requerimientos

Para este peque침o post vamos instalar los paquetes de `tidyverse` (paquete para ciencia de datos) ,`sf` (paquete para manejar datos espaciales de tipo vector), `leaflet` (paquete para generar mapas webs),`leaflet.extras` (plugins para leaflet) y `cptcity` (paleta de colores igual que qgis).

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c("top", "right"), color = "#1739D1")
```

```{r message=FALSE,warning=FALSE, eval=FALSE, class.source='klippy'}
pkgs <- c(
  "tidyverse", "sf", "leaflet",
  "leaflet.extras", "cptcity")

install.packages(pkgs,dependencies = TRUE)

```

## Demo

Llamado o activaci칩n de paquetes:

```{r eval=TRUE,message=FALSE,warning=FALSE}
library(tidyverse)
library(leaflet)
library(leaflet.extras)
library(sf)
library(cptcity)
```

Para est치 ocaci칩n vamos a leer los datos disponibles en el portal de datos abiertos del MINSA donde seleccionaremos los centros de vacunaci칩n para la provincia de Lima metropolitana.

```{r warning=FALSE,message=FALSE}

# Lectura de datos del portal de datos abiertos en un objeto sf
vacunas_geo <- read_csv("https://www.datosabiertos.gob.pe/node/8298/download") %>% 
  st_as_sf(coords = c("longitud","latitud"),crs = 4326) %>% 
  mutate(id = row_number())

```

```{r warning=FALSE, message=FALSE}
# Lectura de los l칤mites provinciales de la regi칩n de inter칠s
lima_prov <- st_read("https://github.com/ambarja/gpkg-pe/raw/main/Lima_provincia.gpkg")

```

```{r warning=FALSE, message=FALSE}
# Centros de vacunaci칩n dentro del 치rea de inter칠s
lista_id <- st_contains(lima_prov,vacunas_geo) %>% unlist()
vacunas_prov <- vacunas_geo %>% 
  filter(id %in% lista_id)

```

Para verificar los puntos dentro del 치rea de interes, con la funci칩n `plot()` hacemos una visualizaci칩n previa.

```{r warning=FALSE, message=FALSE , out.width = "100%"}
st_geometry(vacunas_prov) %>% plot()
```

Ahora usaremos la librer칤a `leaflet` para generar nuestro mapa web, una ventaja de leaflet es que nos ofrece una variedad de basesmaps y esto dependera de tus propia personalizaci칩n y claro tambi칠n de tu subscripci칩n de algunos servicios de ciertas plataformas como HERE entre otros.

Para visualizar todo los basemaps disponibles en leafet usamos la siguiente funci칩n

```{r warning=FALSE, message=FALSE}
# Lista de basemaps disponibles
providers %>%
  map_df(as.data.frame,.id = "basemap") %>% 
  select(basemap) %>% 
  head()
```

Para est치 ocasi칩n usaremos una basemap de tipo satelital y otra de OpenStreetMap

```{r warning=FALSE, message=FALSE ,out.width = "100%"}
vacunas_prov %>% 
  leaflet() %>% 
  addProviderTiles(
    provider = "OpenStreetMap",
    group = "OSM"
    ) %>% 
  addProviderTiles(
    provider = "Esri.WorldImagery",
    group = "Satelital") %>% 
  addMarkers(
    clusterOptions = markerClusterOptions()
    ) %>% 
  addLayersControl(
    baseGroups = c("OSM","Satelital"),
    options = layersControlOptions(collapsed = FALSE)
    ) %>% 
  addResetMapButton() %>% 
  addSearchGoogle()
```

Finalmente, dependiendo del nivel de programaci칩n podr치s personalizar a tu gusto y preferencia 游땙, esto toma tiempo pero existe una amplia documentaci칩n desde lo m치s b치sico hasta un nivel avanzando.

## Recuerda

La visualizaci칩n interactiva de los mapas seguir치 siendo un componente fuerte en la ciencia de datos espaciales, ya que el componente espacial y temporal es fundamental para la toma de desiciones y sobbre todo nos permite contextualizar eventos para tener una perspectiva de lo que viene y pude suceder en el territorio.

## Referencias

-   Rstudio, leaflet for R ,2015, <http://rstudio.github.io/leaflet/>
-   Bert Veenendaal, Maria Antonia Brovelli & Songnian Li, Review of Web Mapping: Eras, Trends and Directions,2017, <https://www.mdpi.com/2220-9964/6/10/317>
